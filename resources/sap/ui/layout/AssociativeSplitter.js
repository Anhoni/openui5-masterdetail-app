/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./Splitter","./SplitterRenderer","sap/base/Log","sap/ui/thirdparty/jquery","sap/ui/layout/SplitterLayoutData"],function(e,t,i,s,a){"use strict";var n=e.extend("sap.ui.layout.AssociativeSplitter",{metadata:{associations:{associatedContentAreas:{type:"sap.ui.core.Control",multiple:true,singularName:"associatedContentArea"}}},renderer:t});n.prototype.init=function(){e.prototype.init.call(this);this._keyListeners={increase:this._onKeyboardResize.bind(this,"inc",1),decrease:this._onKeyboardResize.bind(this,"dec",1),increaseMore:this._onKeyboardResize.bind(this,"incMore",2),decreaseMore:this._onKeyboardResize.bind(this,"decMore",2),max:this._onKeyboardResize.bind(this,"max",1),min:this._onKeyboardResize.bind(this,"min",1)};this._enableKeyboardListeners()};n.prototype._enableKeyboardListeners=function(){e.prototype._enableKeyboardListeners.call(this);this.onsaprightmodifiers=this._keyListeners.increase;this.onsapleftmodifiers=this._keyListeners.decrease;this.onsapupmodifiers=this._keyListeners.decrease;this.onsapdownmodifiers=this._keyListeners.increase;this.onsapright=this._keyListeners.increaseMore;this.onsapdown=this._keyListeners.increaseMore;this.onsapleft=this._keyListeners.decreaseMore;this.onsapup=this._keyListeners.decreaseMore;this.onsapend=this._keyListeners.max;this.onsaphome=this._keyListeners.min;this._keyboardEnabled=true};n.prototype.addAssociatedContentArea=function(e){this._needsInvalidation=true;o(e);return this.addAssociation("associatedContentAreas",e)};n.prototype.indexOfAssociatedContentArea=function(e){var t=this._getContentAreas();for(var i=0;i<t.length;i++){if(e==t[i]){return i}}return-1};n.prototype.insertAssociatedContentArea=function(e,t){var i=e.getId();this._needsInvalidation=true;o(e);var s=this.getAssociatedContentAreas();for(var a=0;a<s.length;a++){if(s[a]===i){s.splice(a,1)}}s.splice(t,0,i);this.setAssociation("associatedContentAreas",null);var n=this;s.forEach(function(e){n.addAssociation("associatedContentAreas",e)})};n.prototype.removeAssociatedContentArea=function(e){this.removeAssociation("associatedContentAreas",e)};n.prototype._getContentAreas=function(){var e=this.getAssociatedContentAreas()||[];var t=this.getContentAreas();var i=e.map(function(e){return sap.ui.getCore().byId(e)}).filter(function(e){return e});return t.concat(i)};n.prototype.ondblclick=function(e){var t=this.getId(),i,s;if(!(e.target.contains(this._oLastDOMclicked)&&this._oLastDOMclicked.id.indexOf(t+"-splitbar")>-1)){return}i=parseInt(this._oLastDOMclicked.id.substr((t+"-splitbar-").length));s=this._getContentAreas()[i];s._currentPosition=this.getCalculatedSizes()[i];s._lastPosition=s._lastPosition||s._currentPosition;if(s._currentPosition===s._lastPosition){this._resizeContents(i,this.getCalculatedSizes()[i]*-1,true)}else{this._resizeContents(i,s._lastPosition,true);s._lastPosition=null}};n.prototype._resizeContents=function(e,t,s){var a,n,o,r,l,h,c,u,d,p,f,_,g,y,z,v,S=parseFloat(this._move.c1Size).toFixed(5),A=parseFloat(this._move.c2Size).toFixed(5),b=parseFloat(S),L=parseFloat(A);if(isNaN(t)){i.warning("Splitter: Received invalid resizing values - resize aborted.");return}a=this._getContentAreas();n=a[e].getLayoutData();o=a[e+1].getLayoutData();r=n.getSize();l=o.getSize();h=this.$("content-"+e);c=this.$("content-"+(e+1));u=b+t;d=L-t;p=parseInt(n.getMinSize());f=parseInt(o.getMinSize());_=this.getOrientation();g=_==="Horizontal"?this.$().width():this.$().height();if(u<p){v=p-u;t+=v;u=p;d-=v}else if(d<f){v=f-d;t-=v;d=f;u-=v}if(s){if(r==="auto"&&l!=="auto"){z=this._pxToPercent(d,g);o.setSize(z)}else if(r!=="auto"&&l==="auto"){y=this._pxToPercent(u,g);n.setSize(y)}else{y=this._pxToPercent(u,g);z=this._pxToPercent(d,g);n.setSize(y);o.setSize(z)}}else{y=this._pxToPercent(u,g);z=this._pxToPercent(d,g);h.css(this._sizeType,y);c.css(this._sizeType,z)}};n.prototype._pxToPercent=function(e,t){return e*100/t+"%"};n.prototype._recalculateSizes=function(){var e,t,s,a,n,o,r;var l=[];var h=this._getContentAreas();var c=this.getOrientation();var u=[];var d=[];var p=[];for(e=0;e<h.length;++e){s=h[e].getLayoutData();t=s?s.getSize():"auto";l.push(t)}var f=this._calculateAvailableContentSize(l)+1;this._calculatedSizes=[];for(e=0;e<l.length;++e){t=l[e];if(t.indexOf("px")>-1){o=parseInt(t);f-=o;this._calculatedSizes[e]=o}else if(t.indexOf("%")>-1){p.push(e)}else if(t==="auto"){s=h[e].getLayoutData();if(s&&parseInt(s.getMinSize())!==0){d.push(e)}else{u.push(e)}}else{i.error("Illegal size value: "+l[e])}}var _=false;if(f<0){_=true;f=0}var g=f;f=c==="Horizontal"?this.$().width():this.$().height();var y=p.length;for(e=0;e<y;++e){n=p[e];if(y===1&&h.length===1){a=f}else{a=parseFloat(l[n])/100*f;r=parseInt(h[n].getLayoutData().getMinSize());if(a<r){a=r}}this._calculatedSizes[n]=a;g-=a}f=g;if(f<0){_=true;f=0}a=Math.floor(f/(d.length+u.length),0);var z=d.length;for(e=0;e<z;++e){n=d[e];r=parseInt(h[n].getLayoutData().getMinSize());if(r>a){this._calculatedSizes[n]=r;f-=r}else{this._calculatedSizes[n]=a;f-=a}}if(f<0){_=true;f=0}g=f;var v=u.length;a=Math.floor(f/v,0);for(e=0;e<v;++e){n=u[e];this._calculatedSizes[n]=a;g-=a}if(_){i.info("[Splitter] The set sizes and minimal sizes of the splitter contents are bigger "+"than the available space in the UI.")}this._calculatedSizes=this._calculatedSizes};n.prototype._ensureAllSplittersCollapsed=function(e){var t=this._getContentAreas();var i=false;for(var s=0;s<t.length;s++){var n=t[s].getLayoutData().getSize().slice(0,-2);if(n==="0"||n==="au"){i=true;continue}else if(s===t.length-1&&i){this._getContentAreas()[e+1].setLayoutData(new a({size:"100%"}))}}};function o(e){var t=e.getLayoutData();if(t&&(!t.getResizable||!t.getSize||!t.getMinSize)){i.warning('Content "'+e.getId()+'" for the Splitter contained wrong LayoutData. '+"The LayoutData has been replaced with default values.");t=null}if(!t){e.setLayoutData(new a)}}return n});