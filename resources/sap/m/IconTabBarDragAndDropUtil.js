/*!
 * OpenUI5
 * (c) Copyright 2009-2020 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/dnd/DragInfo","sap/ui/core/dnd/DropInfo","sap/ui/events/KeyCodes","sap/ui/core/dnd/DropPosition"],function(e,r,t,n){"use strict";var i="Before",o="insertBefore",a="insertAfter",s,g="IconTabReorder";var f={_insertControl:function(e,r,t){if(e===a){r.insertAfter(t)}else{r.insertBefore(t)}},handleDrop:function(e,r,t,g,d){var u=e.indexOfItem(t),c=e.indexOfItem(g),l=t.$(),p=g.$(),D=0,I=sap.ui.getCore().getConfiguration().getRTL(),A=r===i;if(t._isParentOf(g)){return}if(I&&!d){if(A){D=u<c?c:c+1;s=a}else{D=u<c?c-1:c;s=o}}else{if(A){D=u<c?c-1:c;s=o}else{D=u<c?c:c+1;s=a}}if(e.isA("sap.m.IconTabFilter")||!t.getParent().isA("sap.m.IconTabHeader")){if(A){D=c}else{D=c+1}}f._insertControl(s,l,p);if(r===n.On){if(g===t){return}D=e.getAggregation("items").length}f._handleConfigurationAfterDragAndDrop.call(e,t,D)},_updateAccessibilityInfo:function(){var e=this.getItems(),r=1,t;e.forEach(function(e){t=e.getDomRef();if(t&&t.getAttribute("aria-posinset")!==null){t.setAttribute("aria-posinset",r++)}})},_handleConfigurationAfterDragAndDrop:function(e,r){this.removeAggregation("items",e,true);this.insertAggregation("items",e,r,true);f._updateAccessibilityInfo.call(this)},_decreaseDropIndex:function(e,r){var t=e-1;while(t>=0&&(!r[t].getVisible()||r[t].$().hasClass("sapMITBFilterHidden"))){t--}if(t<0){s=a;return e}s=o;return t},_increaseDropIndex:function(e,r,t){var n=e+1;while(n<r.length&&!r[n].getVisible()){n++}if(n>t){s=o;return e}s=a;return n},moveItem:function(e,r,n){var i=e.$(),g=this.getItems(),d=this.indexOfItem(e),u=sap.ui.getCore().getConfiguration().getRTL(),c,l;switch(r){case t.HOME:c=0;s=o;break;case t.END:c=g.length-1;s=a;break;case t.ARROW_LEFT:if(u){c=f._increaseDropIndex(d,g,n)}else{c=f._decreaseDropIndex(d,g)}break;case t.ARROW_RIGHT:if(u){c=f._decreaseDropIndex(d,g)}else{c=f._increaseDropIndex(d,g,n)}break;case t.ARROW_DOWN:c=f._increaseDropIndex(d,g,n);break;case t.ARROW_UP:c=f._decreaseDropIndex(d,g);break;default:return false}l=g[c].$();f._insertControl(s,i,l);f._handleConfigurationAfterDragAndDrop.call(this,e,c);return true},getDraggedDroppedItemsFromList:function(e,r,t){var n,i,o,a=r.getId(),s=t.getId();if(!e&&!r&&!t){return null}e.forEach(function(e){o=e.getId();if(!o){return}if(o===s){n=e}if(o===a){i=e}});return{oDraggedControlFromList:i,oDroppedControlFromList:n}},setDragDropAggregations:function(t,n,i){var o=t._oIconTabHeader?t._oIconTabHeader:t;var a=o.getId();t.addDragDropConfig(new e({sourceAggregation:"items",groupName:g+a}));t.addDragDropConfig(new r({targetAggregation:"items",dropPosition:i,dropLayout:n,drop:t._handleDragAndDrop.bind(t),groupName:g+a}))}};return f});